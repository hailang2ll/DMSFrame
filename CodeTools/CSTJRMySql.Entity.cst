<%@ CodeTemplate Language="C#" TargetLanguage="C#" ResponseEncoding="UTF-8" Description="Generates a very simple business object." %>
<%@ Property Name="SourceTable" Type="SchemaExplorer.TableSchema" Category="Context" Description="Table that the object is based on." %>
<%@ Property Name="Namespace" Type="System.String" Category="Context"   Default="CSTJR.Entity" Description="Namespace that class belongs to." %>
<%@ Assembly Name="SchemaExplorer" %>
<%@ Assembly Name="System.Data" %>
<%@ Assembly Name="System.Net" %>
<%@ Import Namespace="SchemaExplorer" %>
<%@ Import Namespace="System.Data" %>
<%@ Import Namespace="System.Net" %>

//------------------------------------------------------------------------------
// <autogenerated>
//     This code was generated by CodeSmith Template.
//     Creater: dylan
//     Date:    <%= DateTime.Now.ToShortDateString() + " " + DateTime.Now.ToShortTimeString() %>
//     Version: 2.0.0.0
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </autogenerated>
//------------------------------------------------------------------------------

using System;
using System.Collections.Generic;
using DMSFrame;

/// <summary>
/// 
/// </summary>
namespace <%= Namespace.Trim()==""?"CSTJR.Entity.DBEntity":Namespace %>
{	
	/// <summary>
    /// 
	/// </summary>
	[Serializable]
	[TableMapping(Name = "<%= GetClassName(this.SourceTable) %>", PrimaryKey = "<%= GetPrimaryKeyName(SourceTable) %>", DMSDbType = DMSDbType.Mysql, ConfigName = "db_cms01")]
	public class <%= GetClassName(SourceTable) %> : BaseEntity
	{
		#region Private Properties
		
		<% foreach (ColumnSchema column in SourceTable.Columns) { %>
		<%= GetMemberVariableDeclarationStatement(column) %>
		<% } %>
		
		#endregion		
		
		#region Public Properties
		
		<% for (int i = 0; i < SourceTable.PrimaryKey.MemberColumns.Count; i++) { %>
		<% ColumnSchema column = SourceTable.PrimaryKey.MemberColumns[i]; %>		
		/// <summary>
		/// 
		/// </summary>
		[ColumnMapping(Name = "<%= GetPropertyName(column) %>"<% if ((bool)column.ExtendedProperties["CS_IsIdentity"].Value) { %>,AutoIncrement = true<% } %>)]
		public <%= GetCSharpVariableType(column) == "string" ? GetCSharpVariableType(column) : GetCSharpVariableType(column) + "?" %> <%= GetPropertyName(column) %>
		{
			get 
			{
				return <%= GetMemberVariableName(column) %>;
			}
			set 
			{
				object _oldvalue = <%= GetMemberVariableName(column) %>;
				<% if (column.SystemType == typeof(string) && column.NativeType != "text") { %>
				<% if (column.Size>0) { %>
				<%= GetMemberVariableName(column) %> = value.SubStr(<%=column.Size %>);
				<% } else { %>
				<%= GetMemberVariableName(column) %> = value;
				<% } %>
				<% } else { %>
				<%= GetMemberVariableName(column) %> = value;
				<% } %>
				
				if ((value == null) || (!value.Equals(_oldvalue)))
				{
					this.OnPropertyChanged("<%= GetPropertyName(column) %>", _oldvalue, <%= GetMemberVariableName(column) %>);
					<% if (!(bool)column.ExtendedProperties["CS_IsIdentity"].Value) { %>
					this.OnMappingPropertyChanged("<%= GetPropertyName(column) %>", _oldvalue, <%= GetMemberVariableName(column) %>);
					<% } %>
					
				}
			}
		}
		<% }%>
		
		<% for (int i = 0; i < SourceTable.NonPrimaryKeyColumns.Count; i++) { %>		
		<% ColumnSchema column = SourceTable.NonPrimaryKeyColumns[i]; %>
		/// <summary>
		/// 
		/// </summary>
		[ColumnMapping(Name = "<%= GetPropertyName(column) %>"<% if ((bool)column.ExtendedProperties["CS_IsIdentity"].Value) { %>,AutoIncrement = true<% } %>)]
		<% if (column.IsForeignKeyMember) { %>
		public <%= GetClassName(GetForeignKeyTable(column)) %> <%= GetClassName(GetForeignKeyTable(column)) %>
		{
			get 
			{
				return _<%= GetCamelCaseName(GetClassName(GetForeignKeyTable(column))) %>;
			}
			set 
			{
				_<%= GetCamelCaseName(GetClassName(GetForeignKeyTable(column))) %> = value;
			}
		}
		<% } else { %>
		<% string strColLength = GetColLengthString(column); %>
		public <%= GetCSharpVariableType(column) == "string" ? GetCSharpVariableType(column) : GetCSharpVariableType(column) + "?" %> <%= GetPropertyName(column) %>
		{
			get 
			{
				return <%= GetMemberVariableName(column) %>;
			}
			set 
			{
				object _oldvalue = <%= GetMemberVariableName(column) %>;
				<% if (column.SystemType == typeof(string) && column.NativeType != "text") { %>
				<% if (column.Size>0) { %>
				<% if (column.Name.ToLower().IndexOf("imgname")>=0 || column.Name.ToLower().IndexOf("logo")>=0 || column.Name.ToLower().IndexOf("productimg")>=0 || column.Name.ToLower().IndexOf("image")>= 0) {   %>
				<%= GetMemberVariableName(column) %> = value;
				<% }else { %>
				<%= GetMemberVariableName(column) %> = value.SubStr(<%=column.Size %>);
				<% }} else { %>
				<%= GetMemberVariableName(column) %> = value;
				<% } %>
				<% } else { %>
				<%= GetMemberVariableName(column) %> = value;
				<% } %>
				
				if ((value == null) || (!value.Equals(_oldvalue)))
				{
					this.OnPropertyChanged("<%= GetPropertyName(column) %>", _oldvalue, <%= GetMemberVariableName(column) %>);
					<% if (!(bool)column.ExtendedProperties["CS_IsIdentity"].Value) { %>
					this.OnMappingPropertyChanged("<%= GetPropertyName(column) %>", _oldvalue, <%= GetMemberVariableName(column) %>);
					<% } %>
				}
			}
		}
		<% } %>		
		<% if (i < SourceTable.NonPrimaryKeyColumns.Count - 1) Response.Write("\r\n"); %>		
		<% } %>
		
		#endregion
	}
}


<script runat="template">

<!-- #include file="CSTJRGen.inc" -->

private string GetColLengthString(ColumnSchema column)
{
	string strRet = "";
	if (column.DataType == DbType.AnsiString || column.DataType == DbType.AnsiStringFixedLength ||
	    column.DataType == DbType.String || column.DataType == DbType.StringFixedLength ||
	    column.DataType == DbType.Binary)
	{
		strRet += ", Length=" + column.Size.ToString();
	}
	return strRet;
}

</script>